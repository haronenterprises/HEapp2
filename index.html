<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haron Enterprises, LLC - Residential Lease Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f8f7f4; 
            font-family: 'Inter', sans-serif;
        }
        @import url('https://rsms.me/inter/inter.css');
        .form-section { display: none; }
        .form-section.active { display: block; }
        .step-item-active { border-color: #3b82f6; color: #3b82f6; }
        .step-item-complete { border-color: #16a34a; color: #16a34a; background-color: #f0fdf4; }
        
        /* Default Input Style */
        .input-field { 
            @apply w-full px-2 py-1 text-gray-700 bg-white border border-gray-300 rounded-sm text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200; 
        }
        
        /* Error Input Style (Applied via JS) */
        .input-error {
            border-color: #ef4444 !important; /* Red-500 */
            background-color: #fef2f2 !important; /* Red-50 */
            box-shadow: 0 0 0 1px #ef4444 !important;
        }

        .label-text { @apply block text-sm font-medium text-gray-800 py-1; }
        .dynamic-item .remove-btn { display: none; }
        .dynamic-item:hover .remove-btn { display: block; }
        
        /* 3-Column Grid for Section 2 (Applicant Details) */
        .data-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr; 
            gap: 1rem;
        }
        .description-col {
            font-weight: 500;
            color: #1f2937;
            padding-top: 0.35rem;
            line-height: 2.25rem;
        }
        .field-container {
            min-height: 40px;
            display: flex;
            align-items: center;
        }
        
        /* 3-Column Grid for Section 3 (Household Members) */
        .household-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }

        /* Print Styles */
        @media print {
            body { background: #fff; }
            #navigation-controls, #progress-bar, #header, #footer, #application-wizard { display: none !important; }
            .printable-only { display: block !important; }
            .no-print { display: none !important; }
        }
        .printable-only { display: none; }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="container mx-auto px-4 py-8 md:py-12 no-print">
        <header id="header" class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Haron Enterprises, LLC</h1>
            <p class="mt-2 text-lg text-gray-600">Residential Lease Application</p>
            <p class="text-sm text-gray-600 font-semibold">In Accordance with Seminole County NSP Rentals Program</p>
            <p class="text-sm text-red-600 font-bold">AII INCOMPLETE applications will be REJECTED. Tel: (407) 702-3281 / Fax: (866) 858-5371</p>
            <p class="text-sm text-gray-500">Eff date 10 01 25 v51.0</p>
        </header>

        <div id="application-wizard" class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
            <!-- Progress Bar -->
            <div id="progress-bar" class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <div id="step-1" class="step-item step-item-active text-center w-1/6"><div class="border-b-4 pb-2 text-xs md:text-sm font-semibold">Checklist</div></div>
                    <div id="step-2" class="step-item text-center w-1/6"><div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">Address</div></div>
                    <div id="step-3" class="step-item text-center w-1/6"><div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">Household</div></div>
                    <div id="step-4" class="step-item text-center w-1/6"><div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">Financial</div></div>
                    <div id="step-5" class="step-item text-center w-1/6"><div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">History</div></div>
                    <div id="step-6" class="step-item text-center w-1/6"><div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">Final</div></div>
                </div>
            </div>

            <!-- Form -->
            <form id="rental-application-form" class="p-6 md:p-8">
                <div id="status-message" class="text-sm px-4 py-2 rounded-md mb-4 hidden" role="alert"></div>
                
                <!-- SECTION 1: Checklist -->
                <section id="section-1" class="form-section active">
                    <h2 class="text-2xl font-semibold mb-3 text-gray-800">APPLICATION CHECKLIST</h2>
                    <p class="text-gray-600 mb-6 border-b pb-4">Please review and confirm the initial requirements.</p>
                    
                    <div class="space-y-6">
                        <div class="border p-4 rounded-lg bg-gray-50">
                            <h3 class="text-lg font-semibold mb-3 text-gray-700 border-b pb-1">Basic Identification</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><label class="label-text" for="fullName">Full Name</label><input type="text" id="fullName" name="Full Name" class="input-field" required></div>
                                <div><label class="label-text" for="date">Date</label><input type="text" id="date" name="Date" class="input-field" required readonly></div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold mb-3 text-gray-700 border-b pb-1">Required Documentation Checklist</h3>
                            <div class="space-y-2">
                                <!-- First 5 are REQUIRED -->
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_IncomeQualified" class="mr-2" required>I/We understand that this property is owned by a private company and subject to Maximum Income Qualification.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_IncomeRatio" class="mr-2" required>Our Household Income is at least 3 times the monthly Rent amount.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_AdultSignatures" class="mr-2" required>All adult household members (18+) must sign page 6.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_PhotoID" class="mr-2" required>Attach: Copies of photo Identification for all adult household members.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_SocialSecurityCards" class="mr-2" required>Attach: Copies of Social Security Cards for all household members.</label>
                                
                                <!-- Remaining 13 are OPTIONAL (Not Required) -->
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_BirthCertificates" class="mr-2">Copies of birth certificates for all household members under 18.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_PayStubs" class="mr-2">Attach: SIX (6) most current pay check stubs.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_RentProof" class="mr-2">Attach: Proof of last SIX (6) month's rent or mortgage payments.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_SelfEmployedTax" class="mr-2">Attach: If Self-Employed, please provide a signed copy of last year's tax return.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_IncomeExpenseReports" class="mr-2">Attach: If Self-Employed, provide three months of income/expense reports.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_NoIncomeStatement" class="mr-2">Attach: Notarized statement for adult household members with no income.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_EmployerLetter" class="mr-2">Attach: Letter from employer(s).</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_BankStatements" class="mr-2">Attach: Last six (6) months of bank statements.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_AssetsLiabilities" class="mr-2">Attach: Documentation for all Assets and Liabilities.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_CreditReport" class="mr-2">Attach: Copy of credit report for all adults.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_CriminalCheck" class="mr-2">Attach: Criminal background check for all adults.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_ApplicationFee" class="mr-2">Attach: Proof of $50 non-refundable application fee payment.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_AnimalPhotos" class="mr-2">Attach: Photos of any animals that will be living on the premises.</label>
                                <label class="flex items-center text-sm text-gray-700"><input type="checkbox" name="Checklist_OccupancyLimit" class="mr-2">I/We understand the unit has occupancy limits.</label>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION 2: Address & History (3-Column & Vertical Stack) -->
                <section id="section-2" class="form-section">
                    <h2 class="text-2xl font-semibold mb-2 text-gray-800">Detailed Applicant Data & Rental History</h2>
                    <p class="text-gray-600 mb-6">Enter personal details, identification, and rental history for all relevant parties.</p>

                    <div class="data-grid space-y-4 border p-4 rounded-lg bg-white shadow-sm mb-8">
                        <div class="text-sm font-bold description-col border-b pb-2 text-gray-800">DESCRIPTION</div>
                        <div class="text-sm font-bold text-center border-b pb-2 text-gray-800">APPLICANT</div>
                        <div class="text-sm font-bold text-center border-b pb-2 text-gray-800">CO-APPLICANT</div>

                        <div class="description-col">Full Name</div>
                        <div class="field-container"><input type="text" name="Full Name Applicant" class="input-field" required></div>
                        <div class="field-container"><input type="text" name="Full Name CoApplicant" class="input-field"></div>
                        
                        <div class="description-col">Date of Birth</div>
                        <div class="field-container"><input type="date" name="DOB Applicant" class="input-field" required></div>
                        <div class="field-container"><input type="date" name="DOB CoApplicant" class="input-field"></div>
                        
                        <div class="description-col">Phone</div>
                        <div class="field-container"><input type="tel" name="Phone Applicant" class="input-field" required pattern="[0-9]{10}" title="10 numerical digits"></div>
                        <div class="field-container"><input type="tel" name="Phone CoApplicant" class="input-field" pattern="[0-9]{10}"></div>

                        <div class="description-col">Social Security Number</div>
                        <div class="field-container"><input type="text" name="SSN Applicant" class="input-field" required pattern="[0-9]{9}" title="9 digits"></div>
                        <div class="field-container"><input type="text" name="SSN CoApplicant" class="input-field" pattern="[0-9]{9}"></div>

                        <div class="description-col">Email Address</div>
                        <div class="field-container"><input type="email" name="Email Applicant" class="input-field" required></div>
                        <div class="field-container"><input type="email" name="Email CoApplicant" class="input-field"></div>

                        <div class="description-col">Armed Services Member?</div>
                         <div class="field-container"><div class="flex gap-2"><label><input type="radio" name="Armed Services App" value="Yes"> Yes</label><label><input type="radio" name="Armed Services App" value="No"> No</label></div></div>
                          <div class="field-container"><div class="flex gap-2"><label><input type="radio" name="Armed Services CoApp" value="Yes"> Yes</label><label><input type="radio" name="Armed Services CoApp" value="No"> No</label></div></div>

                        <div class="description-col">Driver's License #</div>
                        <div class="field-container"><input type="text" name="DL Applicant" class="input-field" required></div>
                        <div class="field-container"><input type="text" name="DL CoApplicant" class="input-field"></div>

                        <div class="description-col">Vehicle Make & Model</div>
                        <div class="field-container"><input type="text" name="Vehicle Make Applicant" class="input-field"></div>
                        <div class="field-container"><input type="text" name="Vehicle Make CoApplicant" class="input-field"></div>

                        <div class="description-col">Vehicle Tag #</div>
                        <div class="field-container"><input type="text" name="Vehicle Tag Applicant" class="input-field"></div>
                        <div class="field-container"><input type="text" name="Vehicle Tag CoApplicant" class="input-field"></div>

                        <div class="description-col">Name of Nearest Relative</div>
                        <div class="field-container"></div>
                        <div class="field-container"><input type="text" name="Name of Nearest Relative" class="input-field"></div>

                        <div class="description-col">Phone of Nearest Relative</div>
                        <div class="field-container"></div>
                        <div class="field-container"><input type="tel" name="Phone Nearest Relative" class="input-field" pattern="[0-9]{10}"></div>

                        <div class="description-col">Ever Been Evicted?</div>
                         <div class="field-container"><div class="flex gap-2"><label><input type="radio" name="Evicted App" value="Yes"> Yes</label><label><input type="radio" name="Evicted App" value="No"> No</label></div></div>
                          <div class="field-container"><div class="flex gap-2"><label><input type="radio" name="Evicted CoApp" value="Yes"> Yes</label><label><input type="radio" name="Evicted CoApp" value="No"> No</label></div></div>

                        <div class="description-col">Ever Been Foreclosed?</div>
                         <div class="field-container"><div class="flex gap-2"><label><input type="radio" name="Foreclosed App" value="Yes"> Yes</label><label><input type="radio" name="Foreclosed App" value="No"> No</label></div></div>
                          <div class="field-container"><div class="flex gap-2"><label><input type="radio" name="Foreclosed CoApp" value="Yes"> Yes</label><label><input type="radio" name="Foreclosed CoApp" value="No"> No</label></div></div>
                    </div>

                    <!-- CURRENT ADDRESS VERTICAL STACK -->
                    <div class="mt-8">
                        <h3 class="text-xl font-semibold mb-3 text-gray-800 border-b pb-1">Current Address</h3>
                        <div class="p-4 border border-gray-200 rounded-lg bg-gray-50 flex flex-col gap-3 max-w-lg">
                            <div><label class="label-text">Street Address</label><input type="text" name="Current Street Address" class="input-field" required></div>
                            <div><label class="label-text">City, State, Zip</label><input type="text" name="Current City State Zip" class="input-field" required></div>
                            <div><label class="label-text">Contact Person</label><input type="text" name="Current Contact Person" class="input-field" required></div>
                            <div><label class="label-text">Title</label><input type="text" name="Current Contact Title" class="input-field" required></div>
                            <div><label class="label-text">From Date (mm/dd/yyyy)</label><input type="text" id="timeAtCurrentFrom" name="Time At Current From Date" class="input-field" required pattern="\d{2}/\d{2}/\d{4}" placeholder="MM/DD/YYYY"></div>
                            <div><label class="label-text">To Date (mm/dd/yyyy)</label><input type="text" id="timeAtCurrentTo" name="Time At Current To Date" class="input-field" required pattern="\d{2}/\d{2}/\d{4}" placeholder="MM/DD/YYYY"></div>
                            <div><label class="label-text">Monthly Rent</label><input type="number" name="Current Monthly Rent" class="input-field" required min="0"></div>
                            <div><label class="label-text">Security Deposit Return %</label><input type="text" name="Security Deposit Return Percent" class="input-field" required></div>
                            <div><label class="label-text">Reason For Leaving</label><input type="text" name="Reason For Leaving" class="input-field" required></div>
                        </div>

                         <div id="prev-address-container-wrapper" class="hidden mt-6">
                            <h3 class="text-xl font-semibold mb-3 text-gray-800 border-b pb-1">Previous Address History (Required)</h3>
                            <div id="prev-address-container" class="space-y-4"></div>
                            <button type="button" id="add-prev-address-btn" class="mt-4 text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors duration-200">+ Add Previous Address</button>
                         </div>
                    </div>
                </section>

                <!-- SECTION 3: Household Members -->
                <section id="section-3" class="form-section">
                    <h2 class="text-2xl font-semibold mb-2 text-gray-800">Household Members</h2>
                    <p class="text-gray-600 mb-6 border-b pb-4">List all other persons who will occupy the unit (excluding Applicant and Co-Applicant).</p>
                    
                    <div class="household-grid mb-2">
                         <div class="text-sm font-bold text-gray-800">Name</div>
                         <div class="text-sm font-bold text-gray-800">Date of Birth</div>
                         <div class="text-sm font-bold text-gray-800">Relationship to Applicant</div>
                    </div>

                    <div id="household-members-container" class="space-y-4"></div>
                    <button type="button" id="add-member-btn" class="mt-4 text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors duration-200">+ Add Household Member</button>
                </section>

                <!-- SECTION 4: Financial Placeholder -->
                <section id="section-4" class="form-section">
                    <h2 class="text-2xl font-semibold mb-2 text-gray-800">Financial Information</h2>
                    <p class="text-gray-600">Placeholder for Financial Info.</p>
                </section>

                <!-- SECTION 5: History Placeholder -->
                <section id="section-5" class="form-section">
                    <h2 class="text-2xl font-semibold mb-2 text-gray-800">History</h2>
                    <p class="text-gray-600">Placeholder for History Info.</p>
                </section>

                <!-- SECTION 6: Final -->
                <section id="section-6" class="form-section">
                    <h2 class="text-2xl font-semibold mb-2 text-gray-800">Agreement</h2>
                    <div class="mt-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="agree-terms" name="agreement" class="mr-2" required>
                            <span class="ml-2 text-gray-700">I certify that the information provided is true and accurate.</span>
                        </label>
                    </div>
                </section>
            </form>
            
            <!-- Navigation -->
            <div id="navigation-controls" class="p-6 bg-gray-50 border-t border-gray-200 flex justify-between items-center">
                <button type="button" id="prev-btn" class="px-6 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200" style="display: none;">Previous</button>
                <div id="spacer" style="display: block;"></div>
                <button type="button" id="next-btn" class="px-6 py-2 text-sm font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors duration-200">Next</button>
                <button type="button" id="submit-btn" class="px-6 py-2 text-sm font-semibold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200" style="display: none;">Submit Application</button>
            </div>
        </div>
    </div>
    
    <!-- Generated Print View (Hidden until submit) -->
    <div id="print-view" class="printable-only p-8 bg-white"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let currentStep = 1;
            const totalSteps = 6;
            const form = document.getElementById('rental-application-form');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');
            const spacer = document.getElementById('spacer');

            // Set current date
            const today = new Date();
            const yyyy = today.getFullYear();
            let mm = today.getMonth() + 1; 
            let dd = today.getDate();
            if (dd < 10) dd = '0' + dd;
            if (mm < 10) mm = '0' + mm;
            document.getElementById('date').value = `${mm}/${dd}/${yyyy}`;
            
            // Helper functions
            const updateButtons = () => {
                prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
                document.getElementById('spacer').style.display = currentStep === 1 ? 'block' : 'none';
                nextBtn.style.display = currentStep < totalSteps ? 'block' : 'none';
                submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';
            };

            const updateProgressBar = () => {
                for (let i = 1; i <= totalSteps; i++) {
                    const step = document.getElementById(`step-${i}`);
                    step.classList.remove('step-item-active', 'step-item-complete');
                    step.querySelector('div').classList.remove('border-blue-500', 'text-blue-600', 'border-green-500', 'text-green-600');
                    step.querySelector('div').classList.add('border-gray-200', 'text-gray-400');
                    if (i < currentStep) {
                        step.classList.add('step-item-complete');
                        step.querySelector('div').classList.add('border-green-500', 'text-green-600');
                    } else if (i === currentStep) {
                        step.classList.add('step-item-active');
                        step.querySelector('div').classList.add('border-blue-500', 'text-blue-600');
                    }
                }
            };
            
            const showSection = (step) => {
                document.querySelectorAll('.form-section').forEach(section => section.classList.remove('active'));
                document.getElementById(`section-${step}`).classList.add('active');
            };

            const calculateResidencyDuration = (fromDateStr, toDateStr) => {
                const parseDate = (dateStr) => {
                    if (!/^\d{2}\/\d{2}\/\d{4}$/.test(dateStr)) return null;
                    const parts = dateStr.split('/');
                    const date = new Date(parts[2], parts[0] - 1, parts[1]);
                    if (date.getFullYear() != parts[2] || date.getMonth() != parts[0] - 1 || date.getDate() != parts[1]) return null;
                    return date;
                };
                const fromDate = parseDate(fromDateStr);
                const toDate = parseDate(toDateStr);
                if (!fromDate || !toDate || fromDate >= toDate) return 0;
                let months = (toDate.getFullYear() - fromDate.getFullYear()) * 12;
                months -= fromDate.getMonth();
                months += toDate.getMonth();
                return months;
            };

            const togglePreviousAddress = () => {
                const fromDateInput = document.getElementById('timeAtCurrentFrom');
                const toDateInput = document.getElementById('timeAtCurrentTo');
                const wrapper = document.getElementById('prev-address-container-wrapper');
                const prevInputs = document.querySelectorAll('#prev-address-container input');

                if (fromDateInput.checkValidity() && toDateInput.checkValidity() && fromDateInput.value && toDateInput.value) {
                    const durationMonths = calculateResidencyDuration(fromDateInput.value, toDateInput.value);
                    if (durationMonths < 48 && durationMonths > 0) {
                        wrapper.classList.remove('hidden');
                        prevInputs.forEach(input => input.setAttribute('required', ''));
                        if (document.querySelectorAll('#prev-address-container .dynamic-item').length === 0) createPrevAddressBlock();
                    } else {
                        wrapper.classList.add('hidden');
                        prevInputs.forEach(input => input.removeAttribute('required'));
                    }
                } else {
                    wrapper.classList.add('hidden');
                    prevInputs.forEach(input => input.removeAttribute('required'));
                }
            };

            // Dynamic Blocks
            const createDynamicBlock = (containerId, innerHTMLCallback) => {
                const container = document.getElementById(containerId);
                const count = container.querySelectorAll('.dynamic-item').length + 1;
                const newBlock = document.createElement('div');
                newBlock.className = 'p-4 border border-gray-200 rounded-lg relative dynamic-item mb-4 bg-gray-50';
                newBlock.innerHTML = `<button type="button" class="absolute top-2 right-2 text-red-500 hover:text-red-700 remove-btn" onclick="this.parentElement.remove();">âœ•</button>${innerHTMLCallback(count)}`;
                container.appendChild(newBlock);
            };

            const createPrevAddressBlock = () => {
                createDynamicBlock('prev-address-container', (count) => `
                    <div class="space-y-2">
                        <h4 class="font-semibold mb-2 text-sm">Previous Residence ${count}</h4>
                        <div><label class="label-text text-xs">Street Address</label><input type="text" name="Previous Address ${count} Street" class="input-field" required></div>
                        <div><label class="label-text text-xs">City/State/Zip</label><input type="text" name="Previous Address ${count} CityStateZip" class="input-field" required></div>
                        <div><label class="label-text text-xs">From Date</label><input type="text" name="Previous Address ${count} From" class="input-field" placeholder="MM/DD/YYYY" required></div>
                        <div><label class="label-text text-xs">To Date</label><input type="text" name="Previous Address ${count} To" class="input-field" placeholder="MM/DD/YYYY" required></div>
                    </div>`);
            };

            const createHouseholdMemberBlock = () => {
                // Uses the 3-column grid layout for new members
                createDynamicBlock('household-members-container', (count) => `
                    <div class="household-grid">
                        <div><input type="text" name="Household Member ${count} Name" class="input-field" required></div>
                        <div><input type="date" name="Household Member ${count} DOB" class="input-field" required></div>
                        <div><input type="text" name="Household Member ${count} Relationship" class="input-field" required></div>
                    </div>`);
            };
            
             // START: Real-Time Validation
            const enableRealTimeValidation = (section) => {
                const inputs = section.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    input.addEventListener('blur', function() {
                        if (!this.checkValidity()) {
                            this.classList.add('input-error');
                        } else {
                            this.classList.remove('input-error');
                        }
                    });
                    
                    input.addEventListener('input', function() {
                        if (this.checkValidity()) {
                            this.classList.remove('input-error');
                        }
                    });
                });
            };

            // Event Listeners
            nextBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const currentSection = document.getElementById(`section-${currentStep}`);
                // Select only elements that are required AND visible
                const requiredInputs = Array.from(currentSection.querySelectorAll('[required]')).filter(input => {
                     return input.offsetParent !== null; // offsetParent is null if element or ancestor is hidden
                });

                let isValid = true;
                
                requiredInputs.forEach(input => {
                    // Checkbox validation
                    if (input.type === 'checkbox' && !input.checked) {
                        isValid = false;
                        input.reportValidity(); 
                    } else if (!input.checkValidity()) {
                        isValid = false;
                        input.classList.add('input-error'); // Add visual error
                        input.reportValidity(); 
                    }
                });
                
                if (isValid) {
                    if (currentStep === 2) togglePreviousAddress();
                    if (currentStep < totalSteps) { 
                        currentStep++; 
                        showSection(currentStep); 
                        updateButtons(); 
                        updateProgressBar(); 
                        window.scrollTo(0, 0); 
                         // Enable real-time validation for the next section
                         const nextSection = document.getElementById(`section-${currentStep}`);
                         enableRealTimeValidation(nextSection);
                    }
                }
            });

            prevBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentStep > 1) { currentStep--; showSection(currentStep); updateButtons(); updateProgressBar(); window.scrollTo(0, 0); }
            });

            submitBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const agree = document.getElementById('agree-terms');
                if (!agree.checkValidity()) { agree.reportValidity(); return; }
                const formData = new FormData(form);
                
                // GENERATE PDF VIEW
                let reportHTML = `<div class="p-8 font-sans"><header class="text-center mb-6 border-b pb-4"><h1 class="text-2xl font-bold">Haron Enterprises, LLC</h1><h2 class="text-xl">Residential Lease Application</h2><p class="text-sm">Generated: ${new Date().toLocaleDateString()}</p></header><div class="grid grid-cols-2 gap-4 text-sm">`;
                
                for (let [key, value] of formData.entries()) {
                    if(key !== 'agreement') reportHTML += `<div class="border-b py-1"><span class="font-bold">${key}:</span> ${value}</div>`;
                }
                
                reportHTML += `</div><div class="mt-8 text-center no-print"><button class="px-6 py-3 bg-red-600 text-white font-bold rounded shadow" onclick="window.print()">Save to PDF</button></div></div>`;
                
                // Replace body with report
                document.body.innerHTML = reportHTML;
                window.scrollTo(0,0);
            });

            const dateFields = [document.getElementById('timeAtCurrentFrom'), document.getElementById('timeAtCurrentTo')];
            dateFields.forEach(f => f.addEventListener('input', () => { if(f.checkValidity()) togglePreviousAddress(); }));
            document.getElementById('add-prev-address-btn').addEventListener('click', createPrevAddressBlock);
            document.getElementById('add-member-btn').addEventListener('click', createHouseholdMemberBlock);

            // Init
            createPrevAddressBlock(); // Init hidden prev address
            createHouseholdMemberBlock(); // Init one member
            document.getElementById('prev-address-container-wrapper').classList.add('hidden');
            document.querySelectorAll('#prev-address-container input').forEach(input => input.removeAttribute('required'));
            
            showSection(1);
            updateButtons();
            updateProgressBar();
            
            // Enable validation on first section immediately
            enableRealTimeValidation(document.getElementById('section-1'));
        });
    </script>
</body>
</html>
