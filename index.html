<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haron Enterprises, LLC - Residential Lease Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Professional Neutral -->
    <!-- Application Structure Plan: Multi-step wizard with client-side PDF generation (most reliable method without a server). -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            background-color: #f8f7f4; 
            font-family: 'Inter', sans-serif;
        }
        @import url('https://rsms.me/inter/inter.css');
        .form-section {
            display: none;
        }
        .form-section.active {
            display: block;
        }
        
        /* New styles for the 3-column data section */
.data-grid-3 {
    display: grid;
    grid-template-columns: 1.5fr 1fr 1fr; /* Description | Applicant | Co-Applicant */
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
}
.data-grid-3 > div {
    padding: 8px 12px;
    border-bottom: 1px solid #eee;
    border-right: 1px solid #eee;
    min-height: 40px;
    display: flex;
    align-items: center;
}
.data-grid-3 .header-col {
    background-color: #e0eaff; /* Blue-light header */
    font-weight: bold;
    text-align: center;
    border-right: 1px solid #ddd;
}
.data-grid-3 .desc-col {
    background-color: #f9f9f9;
    font-weight: 500;
    color: #374151; /* Gray-700 */
}
.data-grid-3 .input-col {
    background-color: #fff;
    border-bottom: 1px solid #ddd;
}
.data-grid-3 .input-field {
    /* Override global input-field padding for alignment */
    padding: 6px 8px;
}
/* Ensure the last row doesn't have border-bottom */
.data-grid-3 div:nth-last-child(-n+3) {
    border-bottom: none;
}
/* ... existing styles ... */
        .step-item-active {
            border-color: #3b82f6;
            color: #3b82f6;
        }
        .step-item-complete {
            border-color: #16a34a;
            color: #16a34a;
            background-color: #f0fdf4;
        }
        .input-field {
            @apply w-full px-2 py-1 text-gray-700 bg-white border border-gray-300 rounded-sm text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200;
        }
        .label-text {
            @apply block text-sm font-medium text-gray-800 py-1;
        }
        /* START: FIX for Red X on dynamic items */
        .dynamic-item .remove-btn { 
            display: none; 
        }
        .dynamic-item:hover .remove-btn {
            display: block; 
        }
        /* END: FIX for Red X on dynamic items */
        /* Style for print output */
        @media print {
            body { background: #fff; }
            #navigation-controls, #progress-bar, #header, #footer, #application-wizard { display: none !important; }
            .printable-only { display: block !important; }
            .print-button { display: none !important; }
            .no-print { display: none !important; }
        }
        .printable-only {
            display: none;
        }
        /* Custom styles for the 3-column data section */
        .data-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr; /* Custom widths for Description, Applicant, Co-Applicant */
            gap: 1rem; /* Spacing between columns */
        }
        @media (max-width: 768px) {
            .data-grid {
                grid-template-columns: 1fr; /* Stack columns on mobile */
            }
        }
        .description-col {
            font-weight: 500;
            color: #1f2937; /* Gray-800 */
            padding-top: 0.35rem; /* Align with input */
            padding-bottom: 0.35rem; /* Align with input */
            line-height: 2.25rem; /* Match height of input container */
        }
        .field-container {
            min-height: 40px; /* Ensures consistent vertical alignment */
            display: flex;
            align-items: center;
        }
        .input-label-row {
            line-height: 2.25rem; /* Ensures vertical alignment for text fields */
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="container mx-auto px-4 py-8 md:py-12 no-print">
        <header id="header" class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Haron Enterprises, LLC</h1>
            <p class="mt-2 text-lg text-gray-600">Residential Lease Application</p>
            <p class="text-sm text-gray-600 font-semibold">In Accordance with Seminole County NSP Rentals Program</p>
            <p class="text-sm text-red-600 font-bold">AII INCOMPLETE applications will be REJECTED. Tel: (407) 702-3281 / Fax: (866) 858-5371</p>
            <p class="text-sm text-gray-500">Eff date 10 11 25 v51.8</p>
        </header>

        <div id="application-wizard" class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
            <div id="progress-bar" class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <div id="step-1" class="step-item step-item-active text-center w-1/6">
                        <div class="border-b-4 pb-2 text-xs md:text-sm font-semibold">Checklist</div>
                    </div>
                     <div id="step-2" class="step-item text-center w-1/6">
                        <div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">Address</div>
                    </div>
                     <div id="step-3" class="step-item text-center w-1/6">
                        <div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">Household</div>
                    </div>
                     <div id="step-4" class="step-item text-center w-1/6">
                        <div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">Financial</div>
                    </div>
                     <div id="step-5" class="step-item text-center w-1/6">
                        <div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">History</div>
                    </div>
                    <div id="step-6" class="step-item text-center w-1/6">
                        <div class="border-b-4 border-gray-200 pb-2 text-xs md:text-sm font-semibold text-gray-400">Final</div>
                    </div>
                </div>
            </div>

            <!-- CRITICAL FIX: Removed action attribute entirely for self-contained operation -->
            <form id="rental-application-form" class="p-6 md:p-8">
                <div id="status-message" class="text-sm px-4 py-2 rounded-md mb-4 hidden" role="alert"></div>
                
                <!-- START: SECTION 1 (Intro/Checklist) - SIMPLEST LAYOUT FOR TESTING -->
<section id="section-1" class="form-section active">
    <h2 class="text-2xl font-semibold mb-2 text-gray-800">APPLICANT & CO-APPLICANT DATA (Page 1)</h2>
    <p class="text-gray-600 mb-6">Complete all fields. Co-Applicant information is optional. **Required fields are marked with a red asterisk.**</p>

    <div class="data-grid-3">
        
        <div class="desc-col header-col border-none">DESCRIPTION</div>
        <div class="header-col">APPLICANT</div>
        <div class="header-col">CO-APPLICANT (Optional)</div>

        <div class="desc-col">Full Name *</div>
        <div class="input-col"><input type="text" name="Applicant Full Name" class="input-field" required></div>
        <div class="input-col"><input type="text" name="Co-Applicant Full Name" class="input-field"></div>
        
        <div class="desc-col">Date of Birth</div>
        <div class="input-col"><input type="date" name="Applicant Date of Birth" class="input-field"></div>
        <div class="input-col"><input type="date" name="Co-Applicant Date of Birth" class="input-field"></div>

        <div class="desc-col">Social Security Number *</div>
        <div class="input-col"><input type="text" name="Applicant SSN" class="input-field" required pattern="[0-9]{9}" title="9 numerical digits required"></div>
        <div class="input-col"><input type="text" name="Co-Applicant SSN" class="input-field"></div>
        
        <div class="desc-col">Driver's License #/State *</div>
        <div class="input-col"><input type="text" name="Applicant DL #" class="input-field" required></div>
        <div class="input-col"><input type="text" name="Co-Applicant DL #" class="input-field"></div>
        
        <div class="desc-col">Phone *</div>
        <div class="input-col"><input type="tel" name="Applicant Phone" class="input-field" required pattern="[0-9]{10}" title="10 numerical digits required"></div>
        <div class="input-col"><input type="tel" name="Co-Applicant Phone" class="input-field"></div>
        
        <div class="desc-col">Email Address *</div>
        <div class="input-col"><input type="email" name="Applicant Email" class="input-field" required></div>
        <div class="input-col"><input type="email" name="Co-Applicant Email" class="input-field"></div>
        
        <div class="desc-col">Relationship to Other</div>
        <div class="input-col"><input type="text" name="Applicant Relation to Co-Applicant" class="input-field"></div>
        <div class="input-col"><input type="text" name="Co-Applicant Relation to Applicant" class="input-field"></div>

        <div class="desc-col">Current Employer</div>
        <div class="input-col"><input type="text" name="Applicant Current Employer" class="input-field"></div>
        <div class="input-col"><input type="text" name="Co-Applicant Current Employer" class="input-field"></div>
        
        <div class="desc-col">Monthly Income (Gross)</div>
        <div class="input-col"><input type="number" name="Applicant Monthly Income" class="input-field" min="0"></div>
        <div class="input-col"><input type="number" name="Co-Applicant Monthly Income" class="input-field" min="0"></div>
        
        <div class="desc-col">Marital Status</div>
        <div class="input-col"><input type="text" name="Applicant Marital Status" class="input-field"></div>
        <div class="input-col"><input type="text" name="Co-Applicant Marital Status" class="input-field"></div>
        
        <div class="desc-col">Emergency Contact Name</div>
        <div class="input-col"><input type="text" name="Applicant Emergency Contact Name" class="input-field"></div>
        <div class="input-col"><input type="text" name="Co-Applicant Emergency Contact Name" class="input-field"></div>
        
        <div class="desc-col">Emergency Contact Phone</div>
        <div class="input-col"><input type="tel" name="Applicant Emergency Contact Phone" class="input-field"></div>
        <div class="input-col"><input type="tel" name="Co-Applicant Emergency Contact Phone" class="input-field"></div>
        
        <div class="desc-col">U.S. Citizen?</div>
        <div class="input-col"><select name="Applicant Citizen Status" class="input-field"><option>Yes</option><option>No</option></select></div>
        <div class="input-col"><select name="Co-Applicant Citizen Status" class="input-field"><option>Yes</option><option>No</option></select></div>
        
    </div>

    <div class="mt-8 border-t border-gray-300 pt-6">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Rental History (4 Year Minimum Required)</h3>
        <p class="text-sm text-gray-600 mb-4">Provide details for all addresses covering a continuous 4-year period ending with your current address.</p>

        <div id="rental-history-container" class="space-y-4">
            <div class="p-4 border border-yellow-300 bg-yellow-50 rounded-lg dynamic-item" data-residence-count="1">
                <h4 class="font-semibold mb-2">Residence 1 (Current Address)</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div><label class="label-text">Address</label><input type="text" name="Residence 1 Address" class="input-field" required></div>
                    <div><label class="label-text">Landlord/Manager Name</label><input type="text" name="Residence 1 Landlord Name" class="input-field" required></div>
                    <div><label class="label-text">Landlord Phone</label><input type="tel" name="Residence 1 Landlord Phone" class="input-field"></div>
                    <div><label class="label-text">Monthly Rent</label><input type="number" name="Residence 1 Monthly Rent" class="input-field" required></div>
                    <div><label class="label-text">Start Date</label><input type="date" id="rental-start-1" name="Residence 1 Start Date" class="input-field rent-start" required></div>
                    <div><label class="label-text">End Date</label><input type="date" id="rental-end-1" name="Residence 1 End Date" class="input-field rent-end" required></div>
                    <div class="md:col-span-3"><label class="label-text">REASON for Leaving</label><input type="text" name="Residence 1 Reason for Leaving" class="input-field"></div>
                </div>
            </div>
        </div>
        <button type="button" id="add-rental-btn" class="mt-4 btn-secondary text-sm px-3 py-1">Add Previous Residence</button>
        <p id="rental-history-message" class="mt-2 text-sm font-semibold text-red-600 hidden">Required: Total residency must cover a minimum of 4 years. Please add more addresses.</p>
    </div>

    <div class="mt-8 border-t border-gray-300 pt-6">
        <h3 class="text-xl font-bold mb-4 text-gray-800">Other Household Members (Not Applicant/Co-Applicant)</h3>
        <p class="text-sm text-gray-600 mb-4">List up to 3 additional household members living in the home.</p>
        
        <div id="other-members-container" class="space-y-4">
            </div>
        <button type="button" id="add-member-btn" class="mt-4 btn-secondary text-sm px-3 py-1">Add Household Member</button>
    </div>
</section>
                <!-- END: SECTION 1 (Intro/Checklist) -->

                <!-- START: SECTION 2 (Applicant Details & Rental History - 3 COLUMN LAYOUT) -->
                <section id="section-2" class="form-section">
                    
                    <!-- Section 2.1: Applicant/Co-Applicant Data (3-Column Layout) -->
                    <div class="data-grid space-y-4 border p-4 rounded-lg bg-white shadow-sm">
                        
                        <!-- Row 1: Headers -->
                        <div class="text-sm font-bold description-col border-b pb-2 text-gray-800">DESCRIPTION</div>
                        <div class="text-sm font-bold text-center border-b pb-2 text-gray-800">APPLICANT</div>
                        <div class="text-sm font-bold text-center border-b pb-2 text-gray-800">CO-APPLICANT</div>

                        <!-- Row 2: Full Name -->
                        <div class="description-col input-label-row">Full Name</div>
                        <div class="field-container"><input type="text" id="full_name_app" name="Full Name Applicant" class="input-field" required></div>
                        <div class="field-container"><input type="text" id="full_name_co" name="Full Name CoApplicant" class="input-field"></div>
                        
                        <!-- Row 3: Date of Birth -->
                        <div class="description-col input-label-row">Date of Birth</div>
                        <div class="field-container"><input type="date" id="dob_app" name="DOB Applicant" class="input-field" required></div>
                        <div class="field-container"><input type="date" id="dob_co" name="DOB CoApplicant" class="input-field"></div>
                        
                        <!-- Row 4: Social Security Number -->
                        <div class="description-col input-label-row">Social Security Number</div>
                        <div class="field-container"><input type="text" id="ssn_app" name="SSN Applicant" class="input-field" required pattern="[0-9]{9}" title="9 numerical digits required"></div>
                        <div class="field-container"><input type="text" id="ssn_co" name="SSN CoApplicant" class="input-field" pattern="[0-9]{9}" title="9 numerical digits required"></div>

                        <!-- Row 5: Driver's License # -->
                        <div class="description-col input-label-row">Driver's License #</div>
                        <div class="field-container"><input type="text" id="dl_app" name="DL Applicant" class="input-field" required></div>
                        <div class="field-container"><input type="text" id="dl_co" name="DL CoApplicant" class="input-field"></div>

                        <!-- Row 6: Phone -->
                        <div class="description-col input-label-row">Phone</div>
                        <div class="field-container"><input type="tel" id="phone_app" name="Phone Applicant" class="input-field" required pattern="[0-9]{10}" title="10 numerical digits required"></div>
                        <div class="field-container"><input type="tel" id="phone_co" name="Phone CoApplicant" class="input-field" pattern="[0-9]{10}" title="10 numerical digits required"></div>

                        <!-- Row 7: Email Address -->
                        <div class="description-col input-label-row">Email Address</div>
                        <div class="field-container"><input type="email" id="email_app" name="Email Applicant" class="input-field" required></div>
                        <div class="field-container"><input type="email" id="email_co" name="Email CoApplicant" class="input-field"></div>

                         <!-- Row 8: Armed Services -->
                         <div class="description-col input-label-row">Armed Services Member?</div>
                         <div class="field-container">
                             <div class="radio-group justify-center w-full">
                                 <label class="radio-label"><input type="radio" name="Armed Services App" value="yes" class="radio-input mr-1">Yes</label>
                                 <label class="radio-label"><input type="radio" name="Armed Services App" value="no" class="radio-input mr-1" checked>No</label>
                             </div>
                         </div>
                          <div class="field-container">
                              <div class="radio-group justify-center w-full">
                                 <label class="radio-label"><input type="radio" name="Armed Services CoApp" value="yes" class="radio-input mr-1">Yes</label>
                                 <label class="radio-label"><input type="radio" name="Armed Services CoApp" value="no" class="radio-input mr-1" checked>No</label>
                             </div>
                         </div>

                        <!-- Row 9: Vehicle Make & Model -->
                        <div class="description-col input-label-row">Vehicle Make & Model</div>
                        <div class="field-container"><input type="text" id="vehicleMake_app" name="Vehicle Make Applicant" class="input-field"></div>
                        <div class="field-container"><input type="text" id="vehicleMake_co" name="Vehicle Make CoApplicant" class="input-field"></div>

                        <!-- Row 10: Vehicle Tag # -->
                        <div class="description-col input-label-row">Vehicle Tag #</div>
                        <div class="field-container"><input type="text" id="vehicleTag_app" name="Vehicle Tag Applicant" class="input-field"></div>
                        <div class="field-container"><input type="text" id="vehicleTag_co" name="Vehicle Tag CoApplicant" class="input-field"></div>
                        
                        <!-- Row 11: Name of Nearest Relative -->
                        <div class="description-col input-label-row">Name of Nearest Relative</div>
                        <div class="field-container"></div> <!-- Applicant doesn't have a nearest relative field here -->
                        <div class="field-container"><input type="text" id="relativeName" name="Name of Nearest Relative" class="input-field"></div>

                        <!-- Row 12: Phone of Nearest Relative -->
                        <div class="description-col input-label-row">Phone of Nearest Relative</div>
                        <div class="field-container"></div> <!-- Applicant doesn't have a nearest relative field here -->
                        <div class="field-container"><input type="tel" id="relativePhone" name="Phone Nearest Relative" class="input-field" pattern="[0-9]{10}" title="10 numerical digits required"></div>
                        
                        <!-- Row 13: Ever Been Evicted -->
                         <div class="description-col input-label-row">Ever Been Evicted?</div>
                         <div class="field-container">
                             <div class="radio-group justify-center w-full">
                                 <label class="radio-label"><input type="radio" name="Evicted App" value="yes" class="radio-input mr-1">Yes</label>
                                 <label class="radio-label"><input type="radio" name="Evicted App" value="no" class="radio-input mr-1" checked>No</label>
                             </div>
                         </div>
                          <div class="field-container">
                              <div class="radio-group justify-center w-full">
                                 <label class="radio-label"><input type="radio" name="Evicted CoApp" value="yes" class="radio-input mr-1">Yes</label>
                                 <label class="radio-label"><input type="radio" name="Evicted CoApp" value="no" class="radio-input mr-1" checked>No</label>
                             </div>
                         </div>
                         
                         <!-- Row 14: Ever Been Foreclosed -->
                         <div class="description-col input-label-row">Ever Been Foreclosed?</div>
                         <div class="field-container">
                             <div class="radio-group justify-center w-full">
                                 <label class="radio-label"><input type="radio" name="Foreclosed App" value="yes" class="radio-input mr-1">Yes</label>
                                 <label class="radio-label"><input type="radio" name="Foreclosed App" value="no" class="radio-input mr-1" checked>No</label>
                             </div>
                         </div>
                          <div class="field-container">
                              <div class="radio-group justify-center w-full">
                                 <label class="radio-label"><input type="radio" name="Foreclosed CoApp" value="yes" class="radio-input mr-1">Yes</label>
                                 <label class="radio-label"><input type="radio" name="Foreclosed CoApp" value="no" class="radio-input mr-1" checked>No</label>
                             </div>
                         </div>
                    </div>

                    <!-- Rental History Section -->
                    <div class="mt-8">
                        <h3 class="text-xl font-semibold mb-3 text-gray-800 border-b pb-1">Current Address</h3>
                        
                        <!-- Current Address is required and static -->
                        <div class="mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="md:col-span-2"><label class="label-text" for="currentStreet">Street Address</label><input type="text" id="currentStreet" name="Current Street Address" class="input-field" required></div>
                                <div><label class="label-text" for="currentCity">City</label><input type="text" id="currentCity" name="Current City" class="input-field" required></div>
                                <div><label class="label-text" for="currentState">State</label><input type="text" id="currentState" name="Current State" class="input-field" required></div>
                                <div><label class="label-text" for="currentZip">Zip Code</label><input type="text" id="currentZip" name="Current Zip Code" class="input-field" required></div>
                                
                                <div><label class="label-text" for="currentContact">Contact Person</label><input type="text" id="currentContact" name="Current Contact Person" class="input-field" required></div>
                                <div><label class="label-text" for="currentTitle">Title</label><input type="text" id="currentTitle" name="Current Contact Title" class="input-field" required></div>
                                
                                <div><label class="label-text" for="timeAtCurrentFrom">From Date (mm/dd/yyyy)</label><input type="text" id="timeAtCurrentFrom" name="Time At Current From Date" class="input-field" required pattern="\d{2}/\d{2}/\d{4}" placeholder="MM/DD/YYYY"></div>
                                <div><label class="label-text" for="currentMonthlyRent">Monthly Rent</label><input type="number" id="currentMonthlyRent" name="Current Monthly Rent" class="input-field" required min="0"></div>

                                <div><label class="label-text" for="securityDepositReturn">Security Deposit Return %</label><input type="text" id="securityDepositReturn" name="Security Deposit Return Percent" class="input-field" required></div>
                                <div><label class="label-text" for="reasonForLeaving">Reason For Leaving</label><input type="text" id="reasonForLeaving" name="Reason For Leaving" class="input-field" required></div>
                                
                                <div class="md:col-span-2"><label class="label-text" for="currentLandlord">Current Landlord/Mortgage Co.</label><input type="text" id="currentLandlord" name="Current Landlord/Mortgage Co." class="input-field" required></div>
                                <div><label class="label-text" for="currentLandlordPhone">Landlord Phone</label><input type="tel" id="currentLandlordPhone" name="Current Landlord Phone" class="input-field" required></div>
                                
                                
                            </div>
                        </div>

                         <!-- Previous Address Dynamic Blocks (Hidden by default) -->
                         <div id="prev-address-container-wrapper" class="hidden mt-6">
                            <h3 class="text-xl font-semibold mb-3 text-gray-800 border-b pb-1">Previous Address History (Required)</h3>
                            <div id="prev-address-container" class="space-y-4"></div>
                            <button type="button" id="add-prev-address-btn" class="mt-4 text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors duration-200">+ Add Previous Address</button>
                         </div>
                    </div>
                </section>
                <!-- END: SECTION 2 (Applicant Details & Rental History) -->


                <!-- START: SECTION 3 (Household Members & Citizenship) -->
                <section id="section-3" class="form-section">
                    <h2 class="text-2xl font-semibold mb-2 text-gray-800">Household Members</h2>
                    <p class="text-gray-600 mb-6">List all other persons who will occupy the unit (excluding Applicant and Co-Applicant).</p>

                    <!-- Household Members Dynamic Blocks -->
                    <div id="household-members-container" class="mt-4 space-y-4"></div>
                    <button type="button" id="add-member-btn" class="mt-4 text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors duration-200">+ Add Household Member</button>

                    <div class="mt-8 space-y-6">
                        <!-- Citizenship Status -->
                        <div class="p-4 border border-gray-200 rounded-lg">
                            <span class="label-text">Are ALL members of the household U.S. Citizens?</span>
                             <div class="radio-group mt-2">
                                <label class="radio-label"><input type="radio" name="US Citizens" value="yes" class="radio-input mr-2" checked>Yes</label>
                                <label class="radio-label"><input type="radio" name="US Citizens" value="no" class="radio-input mr-2">No</label>
                            </div>
                        </div>
                         <!-- Full-Time Student Status -->
                         <div class="p-4 border border-gray-200 rounded-lg">
                            <span class="label-text">Is any household member (age 18+) a full-time student?</span>
                             <div class="radio-group mt-2">
                                <label class="radio-label"><input type="radio" name="Full-Time Student" value="yes" class="radio-input mr-2">Yes</label>
                                <label class="radio-label"><input type="radio" name="Full-Time Student" value="no" class="radio-input mr-2" checked>No</label>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- END: SECTION 3 (Household Members & Citizenship) -->


                <!-- START: SECTION 4 (Financial & Employment - Placeholder) -->
                <section id="section-4" class="form-section">
                    <h2 class="text-2xl font-semibold mb-2 text-gray-800">Financial & Employment Information</h2>
                    <p class="text-gray-600 mb-6">PLACEHOLDER SECTION - Fill Page 1 to continue to Page 5.</p>
                </section>
                <!-- END: SECTION 4 (Financial & Employment - Placeholder) -->

                <section id="section-5" class="form-section">
                    <h2 class="text-2xl font-semibold mb-2 text-gray-800">Background & History</h2>
                    <p class="text-gray-600 mb-6">PLACEHOLDER SECTION - Fill Page 1 to continue to Page 6.</p>
                </section>

                <section id="section-6" class="form-section">
                    <h2 class="text-2xl font-semibold mb-2 text-gray-800">Authorizations & Agreement</h2>
                    <p class="text-gray-600 mb-6">You're almost done! Please read the following legal statements carefully. Your agreement is required to finalize and submit your application for review.</p>
                    <div class="prose prose-sm max-w-none text-gray-600 bg-gray-50 p-4 rounded-md border border-gray-200">
                        <p><strong>Text:</strong> I/We understand that Florida Statute 817 provides that a person is guilty of a misdemeanor in the first degree who knowingly makes a false statement in writing with the intent to mislead a landlord in repairing or leasing a dwelling unit. I CERTIFY THAT ALL THE INFORMATION PROVIDED IN THIS APPLICATION IS TRUE AND CORRECT. I, the undersigned applicant, affirm the information above is true and complete and authorize Haron Enterprises, LLC to make any and all inquiries necessary to verify said information, including but not limited to, direct contact with any person, business, or agency named above. I also understand that any false information on this application may cause this application to be rejected and may be grounds for immediate termination of the lease at the owner's option. I also agree to all the terms and conditions in the rental agreement, should this application be accepted.</p>
                    </div>
                    <div class="mt-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="agree-terms" name="agreement" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500" required>
                            <span class="ml-3 text-gray-700">By checking this box, you attest that all information provided is true and accurate, and you agree to the terms and authorizations.</span>
                        </label>
                    </div>
                     <div class="mt-8 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
                        <h3 class="font-semibold text-blue-800">Final Step: Application Fee</h3>
                        <p class="text-sm text-blue-700 mt-1">A non-refundable processing fee of $50.00 is required. This fee must be paid prior to an application being accepted or processed. Upon submitting, you will be contacted with payment instructions.</p>
                    </div>
                </section>
            </form>
            
            <div id="navigation-controls" class="p-6 bg-gray-50 border-t border-gray-200 flex justify-between items-center">
                <button type="button" id="prev-btn" class="px-6 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200" style="display: none;">Previous</button>
                <div id="spacer" style="display: block;"></div>
                <button type="button" id="next-btn" class="px-6 py-2 text-sm font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors duration-200">Next</button>
                <button type="button" id="submit-btn" class="px-6 py-2 text-sm font-semibold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200" style="display: none;">Submit Application</button>
            </div>
        </div>
    </div>
    
    <!-- PDF Generation/Print Summary Section (Hidden until Submission) -->
    <div id="print-summary" class="printable-only"></div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // v51.0 (HARON11): Implements 3-column HTML, 4-year validation, and fixes dynamic section logic.
        let currentStep = 1;
        const totalSteps = 6; 
        const form = document.getElementById('rental-application-form');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const spacer = document.getElementById('spacer');

        // --- Core Navigation and UI Functions ---
        
        const updateButtons = () => {
            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            spacer.style.display = currentStep === 1 ? 'block' : 'none';
            nextBtn.style.display = currentStep < totalSteps ? 'block' : 'none';
            submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';
        };

        const showSection = (step) => {
            document.querySelectorAll('.form-section').forEach(section => section.classList.remove('active'));
            const sectionToShow = document.getElementById(`section-${step}`);
            if (sectionToShow) {
                sectionToShow.classList.add('active');
            }
        };

        // --- Rental History Logic (4-Year Validation) ---

        const calculateDateDifferenceInYears = (startDate, endDate) => {
            if (!startDate || !endDate) return 0;
            const start = new Date(startDate);
            const end = new Date(endDate);
            if (end < start) return 0;
            
            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays / 365.25;
        };

        const validateRentalHistory = () => {
            const rentalItems = document.querySelectorAll('#rental-history-container .dynamic-item');
            let totalYears = 0;
            let isValid = true;

            rentalItems.forEach(item => {
                const startDateInput = item.querySelector('.rent-start');
                const endDateInput = item.querySelector('.rent-end');

                // Only count history if both dates are present
                if (startDateInput && endDateInput && startDateInput.value && endDateInput.value) {
                    totalYears += calculateDateDifferenceInYears(startDateInput.value, endDateInput.value);
                }
            });

            const messageElement = document.getElementById('rental-history-message');
            
            if (totalYears < 4) {
                messageElement.textContent = `Required: Total residency must cover a minimum of 4 years. Currently: ${totalYears.toFixed(2)} years. Please add more addresses.`;
                messageElement.classList.remove('hidden');
                isValid = false;
            } else {
                messageElement.classList.add('hidden');
            }
            return isValid;
        };
        
        // --- Event Listeners and Navigation ---

        nextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const currentSection = document.getElementById(`section-${currentStep}`);
            let formIsValid = true;

            // 1. Check all required fields in the current section
            const firstInvalidInput = currentSection.querySelector(':invalid');
            if (firstInvalidInput) {
                firstInvalidInput.reportValidity();
                formIsValid = false;
            }

            // 2. Custom Logic for Screen 1 (Rental Validation)
            if (currentStep === 1 && formIsValid) {
                const rentalIsValid = validateRentalHistory();
                if (!rentalIsValid) {
                    formIsValid = false;
                }
            }

            if (formIsValid) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    showSection(currentStep);
                    updateButtons();
                    // updateProgressBar(); // Keep if this function is defined
                    window.scrollTo(0, 0);
                }
            }
        });

        prevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentStep > 1) {
                currentStep--;
                showSection(currentStep);
                updateButtons();
                // updateProgressBar(); // Keep if this function is defined
                window.scrollTo(0, 0);
            }
        });

        // --- Dynamic Block Helpers ---

        const createDynamicBlock = (containerId, innerHTML) => {
            const container = document.getElementById(containerId);
            const count = container.querySelectorAll('.dynamic-item').length + 1;
            const newBlock = document.createElement('div');
            newBlock.className = 'p-4 border border-gray-200 rounded-lg relative dynamic-item';
            newBlock.innerHTML = innerHTML(count);
            container.appendChild(newBlock);
        };

        // Other Household Member (Page 1)
        document.getElementById('add-member-btn')?.addEventListener('click', () => {
            const memberCount = document.querySelectorAll('#other-members-container .dynamic-item').length;
            if (memberCount >= 3) {
                 alert('You can only list up to 3 additional household members.');
                 return;
            }
            createDynamicBlock('other-members-container', (count) => `
                <button type="button" class="absolute top-2 right-2 text-red-500 hover:text-red-700 remove-btn" onclick="this.parentElement.remove()">&#x2715;</button>
                <h4 class="font-semibold mb-2">Household Member ${count}</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div><label class="label-text">Full Name</label><input type="text" name="Other Member ${count} Full Name" class="input-field"></div>
                    <div><label class="label-text">Date of Birth</label><input type="date" name="Other Member ${count} DOB" class="input-field"></div>
                    <div><label class="label-text">Relationship to Applicant</label><input type="text" name="Other Member ${count} Relationship" class="input-field"></div>
                </div>
            `);
        });

        // Rental History (Page 1)
        document.getElementById('add-rental-btn')?.addEventListener('click', () => {
            const count = document.querySelectorAll('#rental-history-container .dynamic-item').length + 1;
            createDynamicBlock('rental-history-container', (count) => `
                <button type="button" class="absolute top-2 right-2 text-red-500 hover:text-red-700 remove-btn" onclick="this.parentElement.remove(); validateRentalHistory()">&#x2715;</button>
                <h4 class="font-semibold mb-2">Residence ${count} (Previous)</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div><label class="label-text">Address</label><input type="text" name="Residence ${count} Address" class="input-field" required></div>
                    <div><label class="label-text">Landlord/Manager Name</label><input type="text" name="Residence ${count} Landlord Name" class="input-field" required></div>
                    <div><label class="label-text">Landlord Phone</label><input type="tel" name="Residence ${count} Landlord Phone" class="input-field"></div>
                    <div><label class="label-text">Monthly Rent</label><input type="number" name="Residence ${count} Monthly Rent" class="input-field" required></div>
                    <div><label class="label-text">Start Date</label><input type="date" id="rental-start-${count}" name="Residence ${count} Start Date" class="input-field rent-start" required></div>
                    <div><label class="label-text">End Date</label><input type="date" id="rental-end-${count}" name="Residence ${count} End Date" class="input-field rent-end" required></div>
                    <div class="md:col-span-3"><label class="label-text">Reason for Leaving</label><input type="text" name="Residence ${count} Reason for Leaving" class="input-field"></div>
                </div>
            `);
        });

        // Re-validate rental history whenever dates change on Screen 1
        document.getElementById('rental-history-container')?.addEventListener('change', (e) => {
            if (e.target.classList.contains('rent-start') || e.target.classList.contains('rent-end')) {
                validateRentalHistory();
            }
        });


        // --- FINAL PRINT TEMPLATE GENERATION LOGIC (Simplified for reliability) ---

        const generateFinalPrintHtml = (formData) => {
            
            const dataMap = {};
            let rawDataOutput = "--- RAW FORM DATA DUMP ---\n\n";

            for (const [key, value] of formData.entries()) {
                const cleanedKey = key.trim();
                dataMap[cleanedKey] = value;
                rawDataOutput += `KEY: ${cleanedKey}\nVALUE: ${value}\n\n`;
            }

            const getVal = (key) => dataMap[key] || '____________________';

            // Helper to generate dynamic groups (made robust)
            const generateDynamicSection = (data, prefix, fields) => {
                let html = '';
                let groups = {};

                for (const key in data) {
                    if (key.startsWith(prefix)) {
                        const parts = key.split(' ');
                        const numberIndex = parts.find(p => !isNaN(parseInt(p)) && p.length > 0);
                        const indexStart = parts.indexOf(numberIndex);
                        const fieldName = (indexStart !== -1) ? parts.slice(indexStart + 1).join(' ') : parts.slice(prefix.split(' ').length).join(' ');

                        if (numberIndex && fieldName) {
                            if (!groups[numberIndex]) groups[numberIndex] = {};
                            groups[numberIndex][fieldName] = data[key];
                        }
                    }
                }

                for (const index in groups) {
                    html += `<div class="dynamic-group"><h3>${prefix} ${index}</h3>`;
                    for (const field of fields) {
                        const val = groups[index][field] || ''; 
                        html += `<div class="data-row"><span class="data-label">${field}:</span> <span class="data-value">${val ? val : '____________________'}</span></div>`;
                    }
                    html += `</div>`;
                }
                return html || '<p class="note">No items were entered for this section.</p>';
            };

            // --- HTML TEMPLATE START (Reflecting the new 3-column layout) ---
            let finalHtml = `
            <html>
            <head>
                <title>Print Application</title>
                <style>
                    body { font-family: 'Times New Roman', serif; font-size: 11pt; line-height: 1.4; padding: 0.5in; margin: 0; }
                    h1 { font-size: 18pt; text-align: center; margin-bottom: 25px; border-bottom: 2px solid #000; padding-bottom: 10px; }
                    h2 { font-size: 14pt; margin-top: 30px; margin-bottom: 10px; color: #1e3a8a; border-bottom: 1px solid #000; padding-bottom: 5px; }
                    h3 { font-size: 12pt; margin-top: 15px; margin-bottom: 8px; color: #444; }
                    .data-row { margin-bottom: 5px; }
                    .data-label { font-weight: bold; width: 200px; display: inline-block; }
                    .data-value { color: #000; font-weight: normal; border-bottom: 1px solid #000; padding: 0 5px; display: inline-block; min-width: 250px; }
                    .dynamic-group { margin: 10px 0 15px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; page-break-inside: avoid; }
                    .print-page-break { page-break-before: always; height: 1px; display: block; }
                    
                    /* Print Table Styles */
                    .three-col-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                    .three-col-table th, .three-col-table td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 10pt; }
                    .three-col-table th { background-color: #f2f2f2; font-weight: bold; }
                    .grid-label { font-weight: bold; background: #fafafa; width: 30%; }
                    .grid-value { font-weight: normal; }
                </style>
            </head>
            <body>
                <div id="print-content">
                <h1>HARON17 ENTERPRISES, LLC - RESIDENTIAL LEASE APPLICATION (Page 1)</h1>

                <h2>APPLICANT & CO-APPLICANT DATA</h2>
                
                <table class="three-col-table">
                    <tr>
                        <th class="grid-header">Description</th>
                        <th class="grid-header" style="background: #e0eaff;">Applicant</th>
                        <th class="grid-header">Co-Applicant</th>
                    </tr>
                    ${[
                        "Full Name", "Date of Birth", "Social Security Number", "Driver's License #", "Phone", "Email Address",
                        "Relation to Co-Applicant", "Current Employer", "Monthly Income", "Marital Status", 
                        "Emergency Contact Name", "Emergency Contact Phone", "Citizen Status"
                    ].map(field => `
                        <tr>
                            <td class="grid-label">${field.replace(' Relation to Co-Applicant', 'Relationship')}</td>
                            <td class="grid-value">${getVal(`Applicant ${field}`)}</td>
                            <td class="grid-value">${getVal(`Co-Applicant ${field}`)}</td>
                        </tr>
                    `).join('')}
                    
                    <tr><td colspan="3" class="grid-label">Armed Services Member?</td></tr>
                    <tr>
                        <td class="grid-label">Yes/No</td>
                        <td>${getVal('Armed Services App')}</td>
                        <td>${getVal('Armed Services CoApp')}</td>
                    </tr>
                    
                    <tr><td colspan="3" class="grid-label">Ever Been Evicted?</td></tr>
                    <tr>
                        <td class="grid-label">Yes/No</td>
                        <td>${getVal('Evicted App')}</td>
                        <td>${getVal('Evicted CoApp')}</td>
                    </tr>
                    
                    <tr><td colspan="3" class="grid-label">Ever Been Foreclosed?</td></tr>
                    <tr>
                        <td class="grid-label">Yes/No</td>
                        <td>${getVal('Foreclosed App')}</td>
                        <td>${getVal('Foreclosed CoApp')}</td>
                    </tr>

                </table>
                
                <h2>RENTAL HISTORY (4 Year Minimum)</h2>
                ${generateDynamicSection(dataMap, 'Residence', ['Address', 'Landlord Name', 'Start Date', 'End Date', 'Monthly Rent', 'Reason for Leaving'])}

                <div class="print-page-break"></div>

                <h2>OTHER HOUSEHOLD MEMBERS</h2>
                ${generateDynamicSection(dataMap, 'Other Member', ['Full Name', 'DOB', 'Relationship'])}
                
                </div>
            </body>
            </html>
            `;
            // --- HTML TEMPLATE END ---

            return finalHtml;
        };


        // START: CODE FOR FORM SUBMISSION AND PRINTING
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const agreeCheckbox = document.getElementById('agree-terms');
            if (agreeCheckbox && !agreeCheckbox.checkValidity()) {
                agreeCheckbox.reportValidity();
                return;
            }
            
            const printHtml = generateFinalPrintHtml(new FormData(form));
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printHtml);
            printWindow.document.close();

            printWindow.onload = () => {
                printWindow.print();
            };
        });
        // END: CODE FOR FORM SUBMISSION AND PRINTING

        // Initial setup
        showSection(1);
        updateButtons();
    });

    function toggleExplain(radio, divId, showOnYes) {
        // Retaining this function...
    }
</script>

</body>
</html>
